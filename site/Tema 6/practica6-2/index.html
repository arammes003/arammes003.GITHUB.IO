
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://mydomain.org/mysite/Tema%206/practica6-2/">
      
      
        <link rel="prev" href="../practica6-1/">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.39">
    
    
      
        <title>Práctica 6.2 - Despliegue de una aplicación PHP con Nginx y MySQL usando Docker y docker-compose - Alfonso Ramírez Mestanza - DAW</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8c3ca2c6.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#practica-62-despliegue-de-una-aplicacion-php-con-nginx-y-mysql-usando-docker-y-docker-compose" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Alfonso Ramírez Mestanza - DAW" class="md-header__button md-logo" aria-label="Alfonso Ramírez Mestanza - DAW" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Alfonso Ramírez Mestanza - DAW
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Práctica 6.2 - Despliegue de una aplicación PHP con Nginx y MySQL usando Docker y docker-compose
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Alfonso Ramírez Mestanza - DAW" class="md-nav__button md-logo" aria-label="Alfonso Ramírez Mestanza - DAW" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Alfonso Ramírez Mestanza - DAW
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Inicio
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tema 2
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Tema 2
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Tema%202/practica-amplicacion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica de Amplicación.- Configuración de un servidor Nginx con Hosts Virtuales y directorios de usuario
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Tema%202/practica2-1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Practica 2.1 - Instalación y configuración de un servidor web Nginx
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Tema%202/practica2-2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica 2.2 - Autenticación en Nginx
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Tema%202/practica2-3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica 2.3.- Proxy inverso con Nginx
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Tema%202/practica2-4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica 2.4.- Balanceo de carga con proxy inverso en Nginx
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Tema%202/practica2-5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica2.5.- Proxy Inverso y Balanceo de carga con SSL en NGINX
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tema 3
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tema 3
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Tema%203/practica3-1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica 3.1.- Instalación de Tomcat
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Tema%203/practica3-2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica 3.2: Despliegue de aplicaciones con Node Express
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Tema%203/practica3-3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica 3.3.- Despliegue de una aplicación Flask
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tema 4
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Tema 4
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Tema%204/practica4-1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica 4.1.- Configuración de un servidor DNS
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tema 5
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Tema 5
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Tema%205/practica5-1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Practica 5.1.- Ejercicios Git y Github I
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Tema%205/practica5-2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Practica 5.1.- Ejercicios Git y Github II
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tema 6
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Tema 6
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../practica6-1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica 6.1.- Dockerización del despliegue de una aplicación Node.js
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Práctica 6.2 - Despliegue de una aplicación PHP con Nginx y MySQL usando Docker y docker-compose
  </span>
  

      </a>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="practica-62-despliegue-de-una-aplicacion-php-con-nginx-y-mysql-usando-docker-y-docker-compose">Práctica 6.2 - Despliegue de una aplicación PHP con Nginx y MySQL usando Docker y docker-compose</h1>
<h1 id="1-estructura-de-directorios">1.- Estructura de directorios</h1>
<p>Cuando terminemos nuestra práctica, debería quedarnos la siguiente estructura:</p>
<pre><code class="language-bash">/usuario/home/practica6-2/
├── docker-compose.yml
├── nginx
│   ├── default.conf
│   └── Dockerfile
├── php
│   └── Dockerfile
└── www
    └── html
        └── index.php
</code></pre>
<p>Para ello, empezamos creando todos los directorios y archivos de la siguiente forma:</p>
<pre><code class="language-bash">mkdir practica6-2
cd practica6-2
touch docker-compose.yml
mkdir nginx
touch nginx/default.conf
touch nginx/Dockerfile
mkdir php
touch php/Dockerfile
mkdir www
mkdir www/html
touch www/html/index.php
</code></pre>
<p><img alt="alt text" src="../assets/practica6-2/image.png" /></p>
<p>Ahora empezamos con la creación de cada archivo</p>
<h1 id="2-creacion-de-un-contenedor-nginx">2.- Creación de un contenedor Nginx</h1>
<p>El primer paso será crear un contenedor de Nginx dentro de nuestro directorio <code>/practica6-2/docker-compose.yml</code> que permita gestionar nuestra aplicación PHP. Para ello lo editamos con <code>nano docker-compose.yml</code> y añadimos lo siguiente:</p>
<pre><code class="language-bash">services:
    nginx:
      ./assets/practica6-2/image: nginx:latest
      container_name: nginx-container
      ports:
        - 80:80
</code></pre>
<p><img alt="alt text" src="../assets/practica6-2/image-1.png" /></p>
<p>Con esto, creamos un archivo que se encarga de crear un contenedor de Nginx, que escuchará por el puerto 80 del contenedor y de nuestra máquina.</p>
<p>Guardamos los cambios y el siguiente paso es iniciar el proceso con <code>sudo docker-compose up -d</code>;
<img alt="alt text" src="../assets/practica6-2/image-2.png" /></p>
<p>Tras la instalación, comprobamos si el contenedor esta activo con <code>docker ps</code>:
<img alt="alt text" src="../assets/practica6-2/image-3.png" /></p>
<p>Ahora comprobamos que se ha creado el contenedor correctamente abriendo un navegador desde nuestra máquina física y accedemos a <code>http://IP_Maquina_Debian</code>, deberiamos ver un mensaje dando la bienvenida a Nginx:
<img alt="alt text" src="../assets/practica6-2/image-4.png" /></p>
<h1 id="3-creacion-de-un-contenedor-php">3.- Creación de un contenedor PHP</h1>
<p>Ahora editamos el archivo <code>index.php</code> creado anteriormente, o si no lo has creado, lo creas en el directorio <code>/www/html/index.php</code> y añadimos lo siguiente:</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;head&gt;
  &lt;title&gt;¡Hola mundo!&lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;
  &lt;h1&gt;¡Hola mundo!&lt;/h1&gt;
  &lt;p&gt;&lt;?php echo 'Estamos corriendo PHP, version: ' . phpversion(); ?&gt;&lt;/p&gt;
&lt;/body&gt;
</code></pre>
<p><img alt="alt text" src="../assets/practica6-2/image-5.png" /></p>
<p>Guardamos el archivo y ahora editamos el archivo de configuración por defecto para que Nginx pueda correr nuestra aplicación, si no lo habias creado anteriormente, creamos el directorio nginx con <code>mkdir /practica6-2/nginx</code> y el archivo <code>nano practica6-2/nginx/default.conf</code>.</p>
<p>Dentro ponemos la siguiente configuración:</p>
<pre><code class="language-bash">server {

     listen 80 default_server;
     root /var/www/html;
     index index.html index.php;

     charset utf-8;

     location / {
      try_files $uri $uri/ /index.php?$query_string;
     }

     location = /favicon.ico { access_log off; log_not_found off; }
     location = /robots.txt { access_log off; log_not_found off; }

     access_log off;
     error_log /var/log/nginx/error.log error;

     sendfile off;

     client_max_body_size 100m;

     location ~ .php$ {
      fastcgi_split_path_info ^(.+.php)(/.+)$;
      fastcgi_pass php:9000;
      fastcgi_index index.php;
      include fastcgi_params;
      fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
      fastcgi_intercept_errors off;
      fastcgi_buffer_size 16k;
      fastcgi_buffers 4 16k;
    }

     location ~ /.ht {
      deny all;
     }
    }
</code></pre>
<p><img alt="alt text" src="../assets/practica6-2/image-6.png" /></p>
<p>Guardamos el archivo y ahora editamos el archivo <code>Dockerfile</code>, que si no lo hemos creado antes, lo creamos con <code>nano /practica6-2/nginx/Dockerfile</code>. Y dentro del archivo ponemos lo siguiente:
<img alt="alt text" src="../assets/practica6-2/image-7.png" /></p>
<p>Perfecto, tras ese paso modificamos el archivo <code>docker-compose.yml</code> donde crearemos un nuevo contenedor PHP en el puerto 9000, que a su vez esté enlazado con el contenedor nginx, añadimos lo siguiente al fichero que anteriormente ya creamos:</p>
<pre><code class="language-bash">services:
  nginx:
    build: ./nginx/
    container_name: nginx-container
    ports:
      - 80:80
    links:
      - php
    volumes:
      - ./www/html/:/var/www/html/

  php:
    ./assets/practica6-2/image: php:7.0-fpm
    container_name: php-container
    expose:
      - 9000
    volumes:
      - ./www/html/:/var/www/html/
</code></pre>
<p>Quedaría así:
<img alt="alt text" src="../assets/practica6-2/image-8.png" /></p>
<p>El siguiente paso será ejecutar otro <code>docker-compose up -d</code> para que se cree el nuevo contenedor y se modifique el anterior, muy importante ejecutarlo en el directorio donde está el archivo <code>docker-compose.yml</code>, que en este caso es <code>/practica6-2/docker-compose.yml</code>;
<img alt="alt text" src="../assets/practica6-2/image-9.png" /></p>
<p>En este caso nos ha dado un error de que el puerto 80 ya está en uso, para solucionarlo, ejecutamos el comando <code>sudo lsof -i :80</code>, este comando nos muestra los procesos que están usando ese puerto:
<img alt="alt text" src="../assets/practica6-2/image-10.png" /></p>
<p>Cogemos el <strong>PID</strong> del proceso general y ejecutamos un <code>sudo kill PID</code>:
<img alt="alt text" src="../assets/practica6-2/image-11.png" /></p>
<p>Tras ejecutar esto, hacemos otro <code>docker-compose up -d</code> para asegurarnos de que se ha creado correctamente:
<img alt="alt text" src="../assets/practica6-2/image-12.png" /></p>
<p>Ejecutamos un <code>docker ps</code> para ver los contenedores que están activos:
<img alt="alt text" src="../assets/practica6-2/image-13.png" /></p>
<p>Ahora volvemos a acceder a <code>http://IP_Maquina_Debian</code> y deberemos ver el mensaje que pusimos en nuestro <code>index.php</code>
<img alt="alt text" src="../assets/practica6-2/image-14.png" /></p>
<h1 id="4-creacion-de-un-contenedor-para-datos">4.- Creación de un contenedor para datos</h1>
<p>En este paso crearemos un contenedor independiente que se encargará de guardar todos los datos el cuál enlazamos con los demás contenedores. Para ello, editamos otra vez el fichero <code>docker-compose.yml</code> y añadimos lo siguiente:</p>
<pre><code class="language-bash">services:
    nginx:
    build: ./nginx/
    container_name: nginx-container
    ports:
        - 80:80
    links:
        - php
    volumes_from:
        - app-data

    php:
    ./assets/practica6-2/image: php:7.0-fpm
    container_name: php-container
    expose:
        - 9000
    volumes_from:
        - app-data

    app-data:
    ./assets/practica6-2/image: php:7.0-fpm
    container_name: app-data-container
    volumes:
        - ./www/html/:/var/www/html/
    command: &quot;true&quot;
</code></pre>
<p><img alt="alt text" src="../assets/practica6-2/image-16.png" /></p>
<p>Ejecutamos otro <code>docker-compose up -d</code>.
<img alt="alt text" src="../assets/practica6-2/image-17.png" /></p>
<p>Y verificamos que estan activos, deberiamos ver algo como lo siguiente:
<img alt="alt text" src="../assets/practica6-2/image-18.png" /></p>
<h1 id="5-creacion-de-un-contenedor-mysql">5.- Creación de un contenedor MySQL</h1>
<p>Ahora vamos a crear un contenedor MySQL el cuál enlazaremos con los demás contenedores que hemos creado. Para esto, el primer paso será modificar la imagen PHP de nuestro Docker, instalando la extensión de MySQL para PHP, para ello, editamos el archivo <code>practica6-2/php/Dockerfile</code> y ponemos lo siguiente:</p>
<pre><code class="language-bash">FROM php:7.0-fpm
RUN docker-php-ext-install pdo_mysql
</code></pre>
<p><img alt="alt text" src="../assets/practica6-2/image-19.png" /></p>
<p>Tras esto, volvemos a editar el fichero <code>docker-compose.yml</code> para crear un contenedor MySQL y otro que contenga toda la información de la base de datos y las tablas, es decir, todos los datos. Dejaremos el fichero de la siguiente forma:</p>
<pre><code class="language-bash">services:
  nginx:
    build: ./nginx/
    container_name: nginx-container
    ports:
      - 80:80
    links:
      - php
    volumes_from:
      - app-data
  php:
    build: ./php/
    container_name: php-container
    expose:
      - 9000
    links:
      - mysql
    volumes_from:
      - app-data

  app-data:
    ./assets/practica6-2/image: php:7.0-fpm
    container_name: app-data-container
    volumes:
      - ./www/html/:/var/www/html/
    command: &quot;true&quot;

  mysql:
    ./assets/practica6-2/image: mysql:5.7
    container_name: mysql-container
    volumes_from:
      - mysql-data
    environment:
      MYSQL_ROOT_PASSWORD: secret
      MYSQL_DATABASE: mydb
      MYSQL_USER: myuser
      MYSQL_PASSWORD: password

  mysql-data:
    ./assets/practica6-2/image: mysql:5.7
    container_name: mysql-data-container
    volumes:
      - /var/lib/mysql
    command: &quot;true&quot;
</code></pre>
<p><img alt="alt text" src="../assets/practica6-2/image-20.png" /></p>
<p>Cuando ya tengamos guardados los cambios, procedemos a editar el archivo <code>index.php</code> incluyendo cambios para comprobar que se conecta correctamente a la base de datos.</p>
<p>Deberá verse así:</p>
<pre><code class="language-html">     &lt;!DOCTYPE html&gt;
     &lt;head&gt;
      &lt;title&gt;¡Hola mundo!&lt;/title&gt;
     &lt;/head&gt;

     &lt;body&gt;
      &lt;h1&gt;¡Hola mundo!&lt;/h1&gt;
      &lt;p&gt;&lt;?php echo 'Estamos corriendo PHP, version: ' . phpversion(); ?&gt;&lt;/p&gt;
      &lt;?
       $database =&quot;mydb&quot;;
       $user = &quot;myuser&quot;;
       $password = &quot;password&quot;;
       $host = &quot;mysql&quot;;

       $connection = new PDO(&quot;mysql:host={$host};dbname={$database};charset=utf8&quot;, $user, $password);
       $query = $connection-&gt;query(&quot;SELECT TABLE_NAME FROM information_schema.TABLES WHERE TABLE_TYPE='BASE TABLE'&quot;);
       $tables = $query-&gt;fetchAll(PDO::FETCH_COLUMN);

        if (empty($tables)) {
          echo &quot;&lt;p&gt;No hay tablas en la base de datos \&quot;{$database}\&quot;.&lt;/p&gt;&quot;;
        } else {
          echo &quot;&lt;p&gt;La base de datos \&quot;{$database}\&quot; tiene las siguientes tablas:&lt;/p&gt;&quot;;
          echo &quot;&lt;ul&gt;&quot;;
            foreach ($tables as $table) {
              echo &quot;&lt;li&gt;{$table}&lt;/li&gt;&quot;;
            }
          echo &quot;&lt;/ul&gt;&quot;;
        }
        ?&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p><img alt="alt text" src="../assets/practica6-2/image-21.png" /></p>
<p>Tras guardar estos cambios, volvemos a lanzar los contenedores otra vez con <code>docker-compose up -d</code>.
<img alt="alt text" src="../assets/practica6-2/image-22.png" /></p>
<p>Y comprobamos que se están ejecutando con <code>docker ps -a</code>:
<img alt="alt text" src="../assets/practica6-2/image-23.png" /></p>
<h1 id="6-verificacion-de-conexion-a-la-base-de-datos">6.- Verificación de conexión a la base de datos</h1>
<p>Accedemos a <code>http://Ip_Maquina_Debian</code> y deberemos ver lo siguiente:
<img alt="alt text" src="../assets/practica6-2/image-24.png" /></p>
<p>Como se puede ver no aparecen tablas para la base de datos, esto se debe a que las tablas no son visibles para un usuario normal, por lo que debemos cambiar el <code>$user</code> por <code>root</code> y <code>$password</code> por <code>secret</code> en el archivo <code>index.php</code>, quedaría así:</p>
<pre><code class="language-html">     &lt;!DOCTYPE html&gt;
     &lt;head&gt;
      &lt;title&gt;¡Hola mundo!&lt;/title&gt;
     &lt;/head&gt;

     &lt;body&gt;
      &lt;h1&gt;¡Hola mundo!&lt;/h1&gt;
      &lt;p&gt;&lt;?php echo 'Estamos corriendo PHP, version: ' . phpversion(); ?&gt;&lt;/p&gt;
      &lt;?
       $database =&quot;mydb&quot;;
       $user = &quot;root&quot;;
       $password = &quot;secret&quot;;
       $host = &quot;mysql&quot;;

       $connection = new PDO(&quot;mysql:host={$host};dbname={$database};charset=utf8&quot;, $user, $password);
       $query = $connection-&gt;query(&quot;SELECT TABLE_NAME FROM information_schema.TABLES WHERE TABLE_TYPE='BASE TABLE'&quot;);
       $tables = $query-&gt;fetchAll(PDO::FETCH_COLUMN);

        if (empty($tables)) {
          echo &quot;&lt;p&gt;No hay tablas en la base de datos \&quot;{$database}\&quot;.&lt;/p&gt;&quot;;
        } else {
          echo &quot;&lt;p&gt;La base de datos \&quot;{$database}\&quot; tiene las siguientes tablas:&lt;/p&gt;&quot;;
          echo &quot;&lt;ul&gt;&quot;;
            foreach ($tables as $table) {
              echo &quot;&lt;li&gt;{$table}&lt;/li&gt;&quot;;
            }
          echo &quot;&lt;/ul&gt;&quot;;
        }
        ?&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p><img alt="alt text" src="../assets/practica6-2/image-25.png" /></p>
<p>Tras guardar los cambios, volvemos a acceder al navegador y veremos como aparecen todas las tablas:
<img alt="alt text" src="../assets/practica6-2/image-26.png" /></p>
<h1 id="7-esquema-de-la-infraestructura-completa-de-contenedores">7.- Esquema de la infraestructura completa de contenedores</h1>
<p><img alt="alt text" src="../assets/practica6-2/image-15.png" /></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.525ec568.min.js"></script>
      
    
  </body>
</html>